function CytubeEnhanced(channelName,language,modulesSettings){this.channelName=channelName;var translations={};this.language=language||"en",this.modulesSettings=modulesSettings||{};var modulesConstructors={},modules={},MODULE_LOAD_TIMEOUT=1e4,MODULE_LOAD_PERIOD=100;this.getModule=function(moduleName){var promise=$.Deferred(),time=MODULE_LOAD_TIMEOUT;return function getModuleRecursive(){if(void 0!==modules[moduleName])promise.resolve(modules[moduleName]);else{if(0===time)throw new Error("Load timeout for module "+moduleName+".");time-=MODULE_LOAD_PERIOD,setTimeout(getModuleRecursive,MODULE_LOAD_PERIOD)}}(),promise},this.setModule=function(moduleName,moduleConstructor){modulesConstructors[moduleName]=moduleConstructor},this.runModule=function(moduleName){this.isModulePermitted(moduleName)&&(modules[moduleName]=new modulesConstructors[moduleName](this,this.modulesSettings[moduleName]),modules[moduleName].settings=modulesSettings[moduleName],"undefined"!=typeof cytubeEnhancedSettings&&void 0!==cytubeEnhancedSettings.binds&&void 0!==cytubeEnhancedSettings.binds[moduleName]&&void 0!==cytubeEnhancedSettings.binds[moduleName].beforeRun&&cytubeEnhancedSettings.binds[moduleName].beforeRun(modules[moduleName]),void 0!==modules[moduleName].run&&modules[moduleName].run(),"undefined"!=typeof cytubeEnhancedSettings&&void 0!==cytubeEnhancedSettings.binds&&void 0!==cytubeEnhancedSettings.binds[moduleName]&&void 0!==cytubeEnhancedSettings.binds[moduleName].afterRun&&cytubeEnhancedSettings.binds[moduleName].afterRun(modules[moduleName]))},this.isModulePermitted=function(moduleName){return void 0!==this.modulesSettings[moduleName]?this.modulesSettings[moduleName].enabled||!1:!1},this.configureModule=function(moduleName,moduleSettings){this.modulesSettings[moduleName]=moduleSettings},this.addTranslation=function(language,translationObject){translations[language]=translationObject},this.t=function(text){var translatedText=text;if("en"!==this.language&&void 0!==translations[this.language])if(-1!==text.indexOf("[.]")){var textWithNamespaces=text.split("[.]");translatedText=translations[this.language][textWithNamespaces[0]];for(var namespace=1,namespacesLen=textWithNamespaces.length;namespacesLen>namespace;namespace++)translatedText=translatedText[textWithNamespaces[namespace]]}else translatedText=translations[this.language][text];else-1!==text.indexOf("[.]")&&(translatedText=text.split("[.]").pop());return translatedText},this.run=function(){for(var moduleName in modulesConstructors)this.runModule(moduleName)}}var defaultModulesSettings={utils:{enabled:!0,unfixedTopNavbar:!0,insertUsernameOnClick:!0,showScriptInfo:!0},favouritePictures:{enabled:!0},smiles:{enabled:!0},videoControls:{enabled:!0,turnOffVideoOption:!0,selectQualityOption:!0,youtubeFlashPlayerForGoogleDocsOption:!0,expandPlaylistOption:!0,showVideoContributorsOption:!0},showVideoInfo:{enabled:!0},chatCommandsHelp:{enabled:!0},additionalChatCommands:{enabled:!0,additionalPermittedCommands:["*"]},chatControls:{enabled:!0,afkButton:!0,clearChatButton:!0},standardUITranslate:{enabled:!0},navMenuTabs:{enabled:!0},userConfig:{enabled:!0,layoutConfigButton:!0,smilesAndPicturesTogetherButton:!0,minimizeButton:!0}};cytubeEnhanced=new CytubeEnhanced("undefined"!=typeof cytubeEnhancedSettings?cytubeEnhancedSettings.channelName||"Channel name":"Channel name","undefined"!=typeof cytubeEnhancedSettings?cytubeEnhancedSettings.language||"en":"en","undefined"!=typeof cytubeEnhancedSettings?cytubeEnhancedSettings.modulesSettings||defaultModulesSettings:defaultModulesSettings),function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof exports?module.exports=factory:factory(jQuery)}(function($){function handler(event){var orgEvent=event||window.event,args=slice.call(arguments,1),delta=0,deltaX=0,deltaY=0,absDelta=0,offsetX=0,offsetY=0;if(event=$.event.fix(orgEvent),event.type="mousewheel","detail"in orgEvent&&(deltaY=-1*orgEvent.detail),"wheelDelta"in orgEvent&&(deltaY=orgEvent.wheelDelta),"wheelDeltaY"in orgEvent&&(deltaY=orgEvent.wheelDeltaY),"wheelDeltaX"in orgEvent&&(deltaX=-1*orgEvent.wheelDeltaX),"axis"in orgEvent&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS&&(deltaX=-1*deltaY,deltaY=0),delta=0===deltaY?deltaX:deltaY,"deltaY"in orgEvent&&(deltaY=-1*orgEvent.deltaY,delta=deltaY),"deltaX"in orgEvent&&(deltaX=orgEvent.deltaX,0===deltaY&&(delta=-1*deltaX)),0!==deltaY||0!==deltaX){if(1===orgEvent.deltaMode){var lineHeight=$.data(this,"mousewheel-line-height");delta*=lineHeight,deltaY*=lineHeight,deltaX*=lineHeight}else if(2===orgEvent.deltaMode){var pageHeight=$.data(this,"mousewheel-page-height");delta*=pageHeight,deltaY*=pageHeight,deltaX*=pageHeight}if(absDelta=Math.max(Math.abs(deltaY),Math.abs(deltaX)),(!lowestDelta||lowestDelta>absDelta)&&(lowestDelta=absDelta,shouldAdjustOldDeltas(orgEvent,absDelta)&&(lowestDelta/=40)),shouldAdjustOldDeltas(orgEvent,absDelta)&&(delta/=40,deltaX/=40,deltaY/=40),delta=Math[delta>=1?"floor":"ceil"](delta/lowestDelta),deltaX=Math[deltaX>=1?"floor":"ceil"](deltaX/lowestDelta),deltaY=Math[deltaY>=1?"floor":"ceil"](deltaY/lowestDelta),special.settings.normalizeOffset&&this.getBoundingClientRect){var boundingRect=this.getBoundingClientRect();offsetX=event.clientX-boundingRect.left,offsetY=event.clientY-boundingRect.top}return event.deltaX=deltaX,event.deltaY=deltaY,event.deltaFactor=lowestDelta,event.offsetX=offsetX,event.offsetY=offsetY,event.deltaMode=0,args.unshift(event,delta,deltaX,deltaY),nullLowestDeltaTimeout&&clearTimeout(nullLowestDeltaTimeout),nullLowestDeltaTimeout=setTimeout(nullLowestDelta,200),($.event.dispatch||$.event.handle).apply(this,args)}}function nullLowestDelta(){lowestDelta=null}function shouldAdjustOldDeltas(orgEvent,absDelta){return special.settings.adjustOldDeltas&&"mousewheel"===orgEvent.type&&absDelta%120===0}var nullLowestDeltaTimeout,lowestDelta,toFix=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],toBind="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],slice=Array.prototype.slice;if($.event.fixHooks)for(var i=toFix.length;i;)$.event.fixHooks[toFix[--i]]=$.event.mouseHooks;var special=$.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var i=toBind.length;i;)this.addEventListener(toBind[--i],handler,!1);else this.onmousewheel=handler;$.data(this,"mousewheel-line-height",special.getLineHeight(this)),$.data(this,"mousewheel-page-height",special.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var i=toBind.length;i;)this.removeEventListener(toBind[--i],handler,!1);else this.onmousewheel=null;$.removeData(this,"mousewheel-line-height"),$.removeData(this,"mousewheel-page-height")},getLineHeight:function(elem){var $elem=$(elem),$parent=$elem["offsetParent"in $.fn?"offsetParent":"parent"]();return $parent.length||($parent=$("body")),parseInt($parent.css("fontSize"),10)||parseInt($elem.css("fontSize"),10)||16},getPageHeight:function(elem){return $(elem).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel")},unmousewheel:function(fn){return this.unbind("mousewheel",fn)}})}),cytubeEnhanced.setModule("additionalChatCommands",function(app,settings){function isAdditionalCommandPermitted(commandName){return 0===$(settings.additionalPermittedCommands).not(["*"]).length&&0===$(["*"]).not(settings.additionalPermittedCommands).length||-1!==settings.additionalPermittedCommands.indexOf(commandName)||!1}var that=this,defaultSettings={additionalPermittedCommands:["*"]};settings=$.extend(defaultSettings,settings),this.askAnswers=["100%",app.t("qCommands[.]of course"),app.t("qCommands[.]yes"),app.t("qCommands[.]maybe"),app.t("qCommands[.]impossible"),app.t("qCommands[.]no way"),app.t("qCommands[.]don't think so"),app.t("qCommands[.]no"),"50/50",app.t("qCommands[.]fairy is busy"),app.t("qCommands[.]I regret to inform you")],this.randomQuotes=[],this.commandsList={"!pick ":{description:app.t("chatCommands[.]random option from the list of options (!pick option1, option2, option3)"),value:function(msg){var variants=msg.replace("!pick ","").split(",");return variants[Math.floor(Math.random()*(variants.length-1))].trim()},isAvailable:function(){return!0}},"!ask ":{description:app.t("chatCommands[.]asking a question with yes/no/... type answer (e.g. <i>!ask Will i be rich?</i>)"),value:function(){return that.askAnswers[Math.floor(Math.random()*(that.askAnswers.length-1))]},isAvailable:function(){return!0}},"!time":{description:app.t("chatCommands[.]show the current time"),value:function(){var h=(new Date).getHours();10>h&&(h="0"+h);var m=(new Date).getMinutes();return 10>m&&(m="0"+m),app.t("chatCommands[.]current time")+": "+h+":"+m},isAvailable:function(){return!0}},"!dice":{description:app.t("chatCommands[.]throw a dice"),value:function(){return Math.floor(5*Math.random())+1},isAvailable:function(){return!0}},"!roll":{description:app.t("chatCommands[.]random number between 0 and 999"),value:function(){var randomNumber=Math.floor(1e3*Math.random());return 100>randomNumber?randomNumber="0"+randomNumber:10>randomNumber&&(randomNumber="00"+randomNumber),randomNumber},isAvailable:function(){return!0}},"!q":{description:app.t("chatCommands[.]show the random quote"),value:function(msg){return msg=0===that.randomQuotes.length?app.t("chatCommands[.]there aren't any quotes. If you are the channel administrator, you can download them from https://github.com/kaba99/cytube-enhanced/tree/master/files/extra/quotes_for_!q"):that.randomQuotes[Math.floor(Math.random()*(that.randomQuotes.length-1))]},isAvailable:function(){return!0}},"!skip":{description:app.t("chatCommands[.]vote for the video skip"),value:function(msg){return socket.emit("voteskip"),msg=app.t("chatCommands[.]you have been voted for the video skip")},isAvailable:function(){return hasPermission("voteskip")}},"!next":{description:app.t("chatCommands[.]play the next video"),value:function(msg){return socket.emit("playNext"),msg=app.t("chatCommands[.]the next video is playing")},isAvailable:function(){return hasPermission("playlistjump")}},"!bump":{description:app.t("chatCommands[.]bump the last video"),value:function(msg){var last=$("#queue").children().length,uid=$("#queue .queue_entry:nth-child("+last+")").data("uid"),title=$("#queue .queue_entry:nth-child("+last+") .qe_title").html();return socket.emit("moveMedia",{from:uid,after:PL_CURRENT}),msg=app.t("chatCommands[.]the last video was bumped")+title},isAvailable:function(){return hasPermission("playlistmove")}},"!add":{description:app.t("chatCommands[.]adds the video to the end of the playlist (e.g. <i>!add https://www.youtube.com/watch?v=hh4gpgAZkc8</i>)"),value:function(msg){var parsed=parseMediaLink(msg.split("!add ")[1]);return null===parsed.id?msg=app.t("chatCommands[.]error: the wrong link"):(socket.emit("queue",{id:parsed.id,pos:"end",type:parsed.type}),msg=app.t("chatCommands[.]the video was added")),msg},isAvailable:function(){return hasPermission("playlistadd")}},"!now":{description:app.t("chatCommands[.]show the current video's name"),value:function(){return app.t("chatCommands[.]now: ")+$(".queue_active a").html()},isAvailable:function(){return!0}},"!sm":{description:app.t("chatCommands[.]show the random emote"),value:function(){var smilesArray=CHANNEL.emotes.map(function(smile){return smile.name});return smilesArray[Math.floor(Math.random()*smilesArray.length)]+" "},isAvailable:function(){return!0}},"!yoba":{description:app.t("chatCommands[.]the secret command"),value:function(){var $yoba=$('<div class="yoba">').appendTo($(document.body));$('<img src="http://apachan.net/thumbs/201102/24/ku1yjahatfkc.jpg">').appendTo($yoba);var IMBA=new Audio("https://dl.dropboxusercontent.com/s/xdnpynq643ziq9o/inba.ogg");IMBA.volume=.6,IMBA.play();var BGCHANGE=0,inbix=setInterval(function(){$("body").css("background-image","none"),BGCHANGE++,BGCHANGE%2===0?$("body").css("background-color","red"):$("body").css("background-color","blue")},200);return setTimeout(function(){clearInterval(inbix),$("body").css({"background-image":"","background-color":""}),$yoba.remove()},12e3),"YOBA"},isAvailable:function(){return!0}}};var IS_COMMAND=!1;this.prepareMessage=function(msg){IS_COMMAND=!1;for(var command in that.commandsList)if(0===msg.indexOf(command)){isAdditionalCommandPermitted(command)&&that.commandsList[command].isAvailable()&&(IS_COMMAND=!0,msg=that.commandsList[command].value(msg));break}return msg},this.sendUserChatMessage=function(e){if(13!==e.keyCode)return 9===e.keyCode?(chatTabComplete(),e.preventDefault(),!1):38===e.keyCode?(CHATHISTIDX==CHATHIST.length&&CHATHIST.push($("#chatline").val()),CHATHISTIDX>0&&(CHATHISTIDX--,$("#chatline").val(CHATHIST[CHATHISTIDX])),e.preventDefault(),!1):40===e.keyCode?(CHATHISTIDX<CHATHIST.length-1&&(CHATHISTIDX++,$("#chatline").val(CHATHIST[CHATHISTIDX])),e.preventDefault(),!1):void 0;if(!CHATTHROTTLE){var msg=$("#chatline").val().trim();if(""!==msg){var meta={};USEROPTS.adminhat&&CLIENT.rank>=255?msg="/a "+msg:USEROPTS.modhat&&CLIENT.rank>=Rank.Moderator&&(meta.modflair=CLIENT.rank),CLIENT.rank>=2&&0===msg.indexOf("/m ")&&(meta.modflair=CLIENT.rank,msg=msg.substring(3));var msgForCommand=that.prepareMessage(msg);IS_COMMAND?(socket.emit("chatMsg",{msg:msg,meta:meta}),socket.emit("chatMsg",{msg:"Сырно: "+msgForCommand}),IS_COMMAND=!1):socket.emit("chatMsg",{msg:msg,meta:meta}),CHATHIST.push($("#chatline").val()),CHATHISTIDX=CHATHIST.length,$("#chatline").val("")}}},this.run=function(){$("#chatline, #chatbtn").unbind(),$("#chatline").on("keydown",function(e){that.sendUserChatMessage(e)}),$("#chatbtn").on("click",function(e){that.sendUserChatMessage(e)})}}),cytubeEnhanced.setModule("chatCommandsHelp",function(app){var that=this;0===$("#chat-controls").length&&$('<div id="chat-controls" class="btn-group">').appendTo("#chatwrap"),that.commands={},that.commands[app.t("Standard commands")]={"/me":app.t("chatCommands[.]%username% action (e.g: <i>/me is dancing</i>)"),"/sp":app.t("chatCommands[.]spoiler"),"/afk":app.t('chatCommands[.]sets the "AFK" status')},app.isModulePermitted("additionalChatCommands")&&app.getModule("additionalChatCommands").done(function(commandsModule){var additionalCommands={};for(var commandName in commandsModule.commandsList)commandsModule.commandsList[commandName].isAvailable()&&(additionalCommands[commandName]=commandsModule.commandsList[commandName].description);that.commands[app.t("Extra commands")]=additionalCommands}),this.handleChatHelpBtn=function(commands){var $bodyWrapper=$("<div>");for(var commandsPartName in commands){$("<h3>").html(commandsPartName).appendTo($bodyWrapper);var $ul=$("<ul>");for(var command in commands[commandsPartName])$("<li>").html("<code>"+command+"</code> - "+commands[commandsPartName][command]+".").appendTo($ul);$ul.appendTo($bodyWrapper)}app.getModule("utils").done(function(utilsModule){utilsModule.createModalWindow(app.t("The list of chat commands"),$bodyWrapper)})},this.$chatHelpBtn=$('<button id="chat-help-btn" class="btn btn-sm btn-default">').text(app.t("Commands list")).appendTo("#chat-controls").on("click",function(){that.handleChatHelpBtn(that.commands)})}),cytubeEnhanced.setModule("chatControls",function(app,settings){var that=this,defaultSettings={afkButton:!0,clearChatButton:!0};settings=$.extend(defaultSettings,settings),this.handleAfk=function(data){data.name===CLIENT.name&&(data.afk?(that.$afkBtn.removeClass("label-default"),that.$afkBtn.addClass("label-success")):(that.$afkBtn.addClass("label-default"),that.$afkBtn.removeClass("label-success")))},this.handleAfkBtn=function(){socket.emit("chatMsg",{msg:"/afk"})},this.$afkBtn=$('<span id="afk-btn" class="label label-default pull-right pointer">').text(app.t("AFK")).appendTo("#chatheader").on("click",function(){that.handleAfkBtn()}),settings.afkButton||this.$afkBtn.hide(),this.handleClearBtn=function(){confirm(app.t("Are you sure, that you want to clear the chat?"))&&socket.emit("chatMsg",{msg:"/clear"})},this.$clearChatBtn=$('<span id="clear-chat-btn" class="label label-default pull-right pointer">').text(app.t("Clear chat")).insertAfter(that.$afkBtn).on("click",function(){that.handleClearBtn()}),hasPermission("chatclear")&&settings.clearChatButton||this.$clearChatBtn.hide(),this.run=function(){settings.afkButton&&socket.on("setAFK",function(data){that.handleAfk(data)}),settings.clearChatButton&&socket.on("setUserRank",function(){hasPermission("chatclear")?that.$clearChatBtn.show():that.$clearChatBtn.hide()})}}),cytubeEnhanced.setModule("favouritePictures",function(app){var that=this;0===$("#chat-panel").length&&$('<div id="chat-panel" class="row">').insertAfter("#main"),0===$("#chat-controls").length&&$('<div id="chat-controls" class="btn-group">').appendTo("#chatwrap"),this.$toggleFavouritePicturesPanelBtn=$('<button id="favourite-pictures-btn" class="btn btn-sm btn-default" title="'+app.t("favPics[.]Show your favorite images")+'">').html('<i class="glyphicon glyphicon-th"></i>'),0!==$("#smiles-btn").length?this.$toggleFavouritePicturesPanelBtn.insertAfter("#smiles-btn"):this.$toggleFavouritePicturesPanelBtn.prependTo("#chat-controls"),this.$favouritePicturesPanel=$('<div id="favourite-pictures-panel">').appendTo("#chat-panel").hide(),this.$favouritePicturesBodyPanel=$('<div id="pictures-body-panel" class="row">').appendTo(this.$favouritePicturesPanel),this.$favouritePicturesControlPanel=$('<div id="pictures-control-panel" class="row">').appendTo(this.$favouritePicturesPanel),this.$favouritePicturesControlPanelForm=$('<div class="col-md-12">').html('<div class="input-group"><span class="input-group-btn"><button id="export-pictures" class="btn btn-default" style="border-radius: 0;" type="button">'+app.t("favPics[.]Export pictures")+'</button></span><span class="input-group-btn"><label for="import-pictures" class="btn btn-default" style="border-radius: 0;">'+app.t("favPics[.]Import pictures")+'</label><input type="file" style="display: none" id="import-pictures" name="pictures-import"></span><input type="text" id="picture-address" class="form-control" placeholder="'+app.t("favPics[.]Picture address")+'"><span class="input-group-btn"><button id="add-picture-btn" class="btn btn-default" style="border-radius: 0;" type="button">'+app.t("favPics[.]Add")+'</button></span><span class="input-group-btn"><button id="remove-picture-btn" class="btn btn-default" type="button">'+app.t("favPics[.]Remove")+"</button></span></div>").appendTo(this.$favouritePicturesControlPanel),this.entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},this.replaceUnsafeSymbol=function(symbol){return that.entityMap[symbol]},this.renderFavouritePictures=function(){var favouritePictures=JSON.parse(window.localStorage.getItem("favouritePictures"))||[];that.$favouritePicturesBodyPanel.empty();for(var n=0,favouritePicturesLen=favouritePictures.length;favouritePicturesLen>n;n++){var escapedAddress=favouritePictures[n].replace(/[&<>"']/g,that.replaceUnsafeSymbol);$('<img class="favourite-picture-on-panel">').attr({src:escapedAddress}).appendTo(that.$favouritePicturesBodyPanel)}},this.insertFavouritePicture=function(address){app.getModule("utils").done(function(utilsModule){utilsModule.addMessageToChatInput(" "+address+" ","end")})},$(document.body).on("click",".favourite-picture-on-panel",function(){that.insertFavouritePicture($(this).attr("src"))}),this.handleFavouritePicturesPanel=function($toggleFavouritePicturesPanelBtn){var smilesAndPicturesTogether=that.smilesAndPicturesTogether||!1;0===$("#smiles-panel").length||smilesAndPicturesTogether||$("#smiles-panel").hide(),that.$favouritePicturesPanel.toggle(),smilesAndPicturesTogether||($toggleFavouritePicturesPanelBtn.hasClass("btn-default")?(0!==$("#smiles-btn").length&&$("#smiles-btn").hasClass("btn-success")&&($("#smiles-btn").removeClass("btn-success"),$("#smiles-btn").addClass("btn-default")),$toggleFavouritePicturesPanelBtn.removeClass("btn-default"),$toggleFavouritePicturesPanelBtn.addClass("btn-success")):($toggleFavouritePicturesPanelBtn.removeClass("btn-success"),$toggleFavouritePicturesPanelBtn.addClass("btn-default")))},this.$toggleFavouritePicturesPanelBtn.on("click",function(){that.handleFavouritePicturesPanel($(this))}),this.showPicturePreview=function(address){$picture=$('<img src="'+address+'">'),$picture.ready(function(){var $modalPicture=($('<div id="modal-picture-overlay">').appendTo($(document.body)),$('<div id="modal-picture">').appendTo($(document.body)).draggable()),pictureWidth=$picture.prop("width"),pictureHeight=$picture.prop("height"),$modalPictureOptions=$('<div id="modal-picture-options">');$modalPicture.append($('<div id="modal-picture-options-wrapper">').append($modalPictureOptions));var scaleFactor=($('<a href="'+$picture.prop("src")+'" target="_blank" class="btn btn-sm btn-default" style="width:40px;"><i class="glyphicon glyphicon-eye-open"></i></button>').appendTo($modalPictureOptions),$('<a href="https://www.google.com/searchbyimage?image_url='+$picture.prop("src")+'" target="_blank" class="btn btn-sm btn-default" style="width:40px;"><i class="glyphicon glyphicon-search"></i></button>').appendTo($modalPictureOptions),1);pictureWidth>document.documentElement.clientWidth&&pictureHeight>document.documentElement.clientHeight?scaleFactor=pictureHeight-document.documentElement.clientHeight>pictureWidth-document.documentElement.clientWidth?pictureHeight/(.8*document.documentElement.clientHeight):pictureWidth/(.8*document.documentElement.clientWidth):pictureHeight>document.documentElement.clientHeight?scaleFactor=pictureHeight/(.8*document.documentElement.clientHeight):pictureWidth>document.documentElement.clientWidth&&(scaleFactor=pictureWidth/(.8*document.documentElement.clientWidth)),pictureHeight/=scaleFactor,pictureWidth/=scaleFactor,$modalPicture.css({width:pictureWidth,height:pictureHeight,marginLeft:-(pictureWidth/2),marginTop:-(pictureHeight/2)}),$picture.appendTo($modalPicture)})},$(document.body).on("click",".chat-picture",function(){that.showPicturePreview($(this).prop("src"))}),this.ZOOM_CONST=.15,this.handleModalPictureMouseWheel=function(e){var pictureWidth=parseInt($("#modal-picture").css("width"),10),pictureHeight=parseInt($("#modal-picture").css("height"),10),pictureMarginLeft=parseInt($("#modal-picture").css("marginLeft"),10),pictureMarginTop=parseInt($("#modal-picture").css("marginTop"),10);$("#modal-picture").css(e.deltaY>0?{width:pictureWidth*(1+that.ZOOM_CONST),height:pictureHeight*(1+that.ZOOM_CONST),marginLeft:pictureMarginLeft+-pictureWidth*that.ZOOM_CONST/2,marginTop:pictureMarginTop+-pictureHeight*that.ZOOM_CONST/2}:{width:pictureWidth*(1-that.ZOOM_CONST),height:pictureHeight*(1-that.ZOOM_CONST),marginLeft:pictureMarginLeft+pictureWidth*that.ZOOM_CONST/2,marginTop:pictureMarginTop+pictureHeight*that.ZOOM_CONST/2})},$(document.body).on("mousewheel","#modal-picture",function(e){return that.handleModalPictureMouseWheel(e),!1}),this.closePictureByClick=function(){$("#modal-picture-overlay").remove(),$("#modal-picture").remove()},$(document.body).on("click","#modal-picture-overlay, #modal-picture",function(){that.closePictureByClick()}),this.closePictureByEscape=function(e){27===e.which&&0!==$("#modal-picture").length&&($("#modal-picture-overlay").remove(),$("#modal-picture").remove())},$(document.body).on("keydown",function(e){that.closePictureByEscape(e)}),this.addFavouritePicture=function(){if(""!==$("#picture-address").val()){var favouritePictures=JSON.parse(window.localStorage.getItem("favouritePictures"))||[];if(-1!==favouritePictures.indexOf($("#picture-address").val()))return makeAlert(app.t("favPics[.]The image already exists")).prependTo(that.$favouritePicturesBodyPanel),$("#picture-address").val(""),!1;""!==$("#picture-address").val()&&favouritePictures.push($("#picture-address").val()),$("#picture-address").val(""),window.localStorage.setItem("favouritePictures",JSON.stringify(favouritePictures)),that.renderFavouritePictures()}},$("#add-picture-btn").on("click",function(){that.addFavouritePicture()}),this.removeFavouritePicture=function(){var favouritePictures=JSON.parse(window.localStorage.getItem("favouritePictures"))||[],removePosition=favouritePictures.indexOf($("#picture-address").val());-1!==removePosition&&(favouritePictures.splice(removePosition,1),window.localStorage.setItem("favouritePictures",JSON.stringify(favouritePictures)),that.renderFavouritePictures()),$("#picture-address").val("")},$("#remove-picture-btn").on("click",function(){that.removeFavouritePicture()}),this.exportPictures=function(){var $downloadLink=$("<a>").attr({href:"data:text/plain;charset=utf-8,"+encodeURIComponent(window.localStorage.getItem("favouritePictures")||JSON.stringify([])),download:"cytube_enhanced_favourite_images.txt"}).hide().appendTo($(document.body));$downloadLink[0].click(),$downloadLink.remove()},$("#export-pictures").on("click",function(){that.exportPictures()}),this.importPictures=function(importFile){var favouritePicturesAddressesReader=new FileReader;favouritePicturesAddressesReader.addEventListener("load",function(e){window.localStorage.setItem("favouritePictures",e.target.result),that.renderFavouritePictures()}),favouritePicturesAddressesReader.readAsText(importFile)},$("#import-pictures").on("change",function(){that.importPictures($(this)[0].files[0])}),this.run=function(){that.renderFavouritePictures()}}),cytubeEnhanced.setModule("navMenuTabs",function(app){var that=this;this.addTabInput=function($tabsArea,tabName,tabValue){tabName=tabName||"",tabValue=tabValue||"";{var $wrapper=$('<div class="row tab-option-wrapper">').appendTo($tabsArea),$tabNameWrapperOfWrapper=$('<div class="col-sm-4 col-md-3">').appendTo($wrapper),$tabNameWrapper=$('<div class="form-group">').appendTo($tabNameWrapperOfWrapper),$tabValueWrapperOfWrapper=($('<input name="title" type="text" class="form-control" placeholder="'+app.t("tabs[.]Title")+'">').val(tabName).appendTo($tabNameWrapper),$('<div class="col-sm-8 col-md-9">').appendTo($wrapper)),$tabValueWrapper=$('<div class="form-group">').appendTo($tabValueWrapperOfWrapper);$('<input name="content" type="text" class="form-control" placeholder="'+app.t("tabs[.]Content")+'">').val(tabValue).appendTo($tabValueWrapper)}},this.tabsConfigToHtml=function(channelDescription,tabsConfig){var $virtualMainWrapper=$("<div>");if(void 0!==channelDescription&&""!==channelDescription&&$('<div id="motd-channel-description">').html(channelDescription).appendTo($virtualMainWrapper),0!==tabsConfig.length)for(var TAB_TITLE=0,TAB_CONTENT=1,LINK_TITLE=0,LINK_ADDRESS=1,$tabsWrapper=$('<div id="motd-tabs-wrapper">').appendTo($virtualMainWrapper),$tabs=$('<div id="motd-tabs">').appendTo($tabsWrapper),$tabsContent=$('<div id="motd-tabs-content">').appendTo($tabsWrapper),tabIndex=0,tabsLength=tabsConfig.length;tabsLength>tabIndex;tabIndex++)if(0===tabsConfig[tabIndex][TAB_TITLE].indexOf("!dropdown!")){for(var $dropdownWrapper=$('<div class="btn-group">'),$dropdownMenu=($('<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">').html(tabsConfig[tabIndex][TAB_TITLE].replace("!dropdown!","")+' <span class="caret"></span>').appendTo($dropdownWrapper),$('<ul class="dropdown-menu">').appendTo($dropdownWrapper)),linksConfig=tabsConfig[tabIndex][TAB_CONTENT],linkIndex=0,linksLength=tabsConfig[tabIndex][TAB_CONTENT].length;linksLength>linkIndex;linkIndex++){var $link=$("<a>").attr({href:linksConfig[linkIndex][LINK_ADDRESS],target:"_blank"}).text(linksConfig[linkIndex][LINK_TITLE]);$("<li>").html($link).appendTo($dropdownMenu)}$dropdownWrapper.appendTo($tabs)}else $('<button class="btn btn-default motd-tab-btn" data-tab-index="'+tabIndex+'">').html(tabsConfig[tabIndex][TAB_TITLE]).appendTo($tabs),$('<div class="motd-tab-content" data-tab-index="'+tabIndex+'">').hide().html(tabsConfig[tabIndex][TAB_CONTENT]).appendTo($tabsContent);return $virtualMainWrapper.html()},this.tabsHtmlToCondig=function(htmlCode){that.$tabsArea.empty();var $tabsTree=$("<div>").html(htmlCode),$tabsTreeNavBtns=$tabsTree.find("#motd-tabs").children(),$tabsTreeTabsContent=$tabsTree.find("#motd-tabs-content");$("#channel-description-input").val($tabsTree.find("#motd-channel-description").html()),$tabsTreeNavBtns.each(function(){if($(this).hasClass("btn-group")){var parsedDropdownItems="",$dropdownItems=$(this).children("ul").children();$dropdownItems.each(function(){var link=$(this).children("a");parsedDropdownItems+="[n]"+link.text()+"[/n][a]"+link.attr("href")+"[/a], "}),parsedDropdownItems=parsedDropdownItems.slice(0,-2),that.addTabInput(that.$tabsArea,"!dropdown!"+$(this).children("button").html().replace(' <span class="caret"></span>',""),parsedDropdownItems)}else that.addTabInput(that.$tabsArea,$(this).html(),$tabsTreeTabsContent.find('[data-tab-index="'+$(this).data("tabIndex")+'"]').html())})},this.motdCutMap={"<iframe $1>$2</iframe>":/\[iframe(.*?)\](.*?)[/iframe]]/g},this.fixMotdCut=function(){$("#motd-tabs-content").find(".motd-tab-content").each(function(){for(var tag in that.motdCutMap)$(this).html($(this).html().replace(that.motdCutMap[tag],tag))})},this.$tabSettingsBtn=$('<button type="button" class="btn btn-primary motd-bottom-btn" id="show-tabs-settings">').text(app.t("tabs[.]Show tabs settings (cytube enhanced)")).appendTo("#cs-motdeditor").on("click",function(){$(this).hasClass("btn-primary")?(that.$tabsSettings.show(),$(this).removeClass("btn-primary"),$(this).addClass("btn-success")):(that.$tabsSettings.hide(),$(this).removeClass("btn-success"),$(this).addClass("btn-primary"))}),this.$tabsSettings=$('<div id="tabs-settings">').html("<hr><h3>"+app.t("tabs[.]Tabs settings")+"</h3>").insertBefore("#cs-motdtext").hide(),$("#cs-motdtext").before("<hr>"),this.$channelDescriptionInputWrapper=$('<div class="form-group">').appendTo(this.$tabsSettings),this.$channelDescriptionLabel=$('<label for="channel-description-input">'+app.t("tabs[.]Channel description")+"</label>").appendTo(this.$channelDescriptionInputWrapper),this.$channelDescriptionInput=$('<input id="channel-description-input" placeholder="'+app.t("tabs[.]Channel description")+'" class="form-control">').appendTo(this.$channelDescriptionInputWrapper),this.$tabsArea=$('<div id="tabs-settings-area">').appendTo(this.$tabsSettings),$("<p>Вкладки</p>").insertBefore(this.$tabsArea),this.$addTabToTabsSettingsBtn=$('<button type="button" class="btn btn-sm btn-primary" id="tabs-settings-add">').text(app.t("tabs[.]Add tab")).appendTo(this.$tabsSettings).on("click",function(){that.addTabInput(that.$tabsArea)}),this.$removeLastTabFromTabsSettingsBtn=$('<button type="button" class="btn btn-sm btn-primary" id="tabs-settings-remove">').text(app.t("tabs[.]Remove the last tab")).appendTo(this.$tabsSettings).on("click",function(){that.$tabsArea.children(".tab-option-wrapper").last().remove()}),this.$tabsToHtml=$('<button type="button" class="btn btn-sm btn-primary" id="tabs-settings-to-html">').text(app.t("tabs[.]Convert to the editor's code")).appendTo(this.$tabsSettings).on("click",function(){if(confirm(app.t("tabs[.]The code in the editor will be replaced with the new code, continue?"))){var tabsConfig=[];that.$tabsArea.find(".tab-option-wrapper").each(function(){var tabName=$(this).find('input[name="title"]').val().trim(),tabContent=$(this).find('input[name="content"]').val().trim();if(0===tabName.indexOf("!dropdown!")){if(!/^(?:\[n\](.+?)\[\/n\]\[a\](.+?)\[\/a\][ ]*,[ ]*)*\[n\](.+?)\[\/n\]\[a\](.+?)\[\/a\]$/.test(tabContent))return void alert(app.t("tabs[.]The wrong content for the dropdown")+tabName.replace("!dropdown!","")+".");tabContent=tabContent.split(",").map(function(linkInfo){return linkInfo=linkInfo.trim().match(/^\[n\](.+?)\[\/n\]\[a\](.+?)\[\/a\]$/),[linkInfo[1].trim(),linkInfo[2].trim()]})}tabsConfig.push([tabName,tabContent])}),$("#cs-motdtext").val(that.tabsConfigToHtml(that.$channelDescriptionInput.val(),tabsConfig));

}}),this.$htmlToTabs=$('<button type="button" class="btn btn-sm btn-primary" id="tabs-settings-from-html">').text(app.t("tabs[.]Convert from the editor's code")).appendTo(this.$tabsSettings).on("click",function(){that.tabsHtmlToCondig($("#cs-motdtext").val())}),this.showMotdTab=function($tabBtn){var $tabContent=$("#motd-tabs-content").find('[data-tab-index="'+$tabBtn.data("tabIndex")+'"]');$tabBtn.hasClass("btn-default")?($(".motd-tab-content").hide(),$tabContent.show(),$(".motd-tab-btn").removeClass("btn-success"),$(".motd-tab-btn").addClass("btn-default"),$tabBtn.removeClass("btn-default"),$tabBtn.addClass("btn-success")):($tabContent.hide(),$tabBtn.removeClass("btn-success"),$tabBtn.addClass("btn-default"))},$(document.body).on("click","#motd-tabs .motd-tab-btn",function(){that.showMotdTab($(this))}),this.motdHandleDropdown=function(){$(".motd-tab-btn").removeClass("btn-success"),$(".motd-tab-btn").addClass("btn-default"),$(".motd-tab-content").hide()},$(document.body).on("click","#motd-tabs .dropdown-toggle",function(){that.motdHandleDropdown()}),this.run=function(){that.tabsHtmlToCondig($("#cs-motdtext").val()),that.fixMotdCut(),socket.on("setMotd",function(){that.fixMotdCut()})}}),cytubeEnhanced.setModule("showVideoInfo",function(app){var that=this;this.$titleRow=$('<div id="titlerow" class="row">').insertBefore("#main"),this.$titleRowOuter=$('<div id="titlerow-outer" class="col-md-12" />').html($("#currenttitle").text(""!==$(".queue_active a").text()?$("#currenttitle").text().replace(/^Currently Playing:/,app.t("videoInfo[.]Now:")):"").detach()).appendTo(this.$titleRow),this.$mediaInfo=$('<p id="mediainfo">').prependTo("#videowrap"),this.showPlaylistInfo=function(){0!==$(".queue_active").length?($("#currenttitle").text($("#currenttitle").text().replace(/^Currently Playing:/,app.t("videoInfo[.]Now:"))),that.$mediaInfo.text($(".queue_active").attr("title").replace("Added by",app.t("videoInfo[.]Added by")))):($("#currenttitle").text(""),that.$mediaInfo.text(app.t("videoInfo[.]Nothing is playing now")))},this.run=function(){that.showPlaylistInfo(),socket.on("changeMedia",function(){that.showPlaylistInfo()})}}),cytubeEnhanced.setModule("smiles",function(app){var that=this;0===$("#chat-panel").length&&$('<div id="chat-panel" class="row">').insertAfter("#main"),0===$("#chat-controls").length&&$('<div id="chat-controls" class="btn-group">').appendTo("#chatwrap"),$("#emotelistbtn").hide(),this.$smilesBtn=$('<button id="smiles-btn" class="btn btn-sm btn-default" title="'+app.t("emotes[.]Show emotes")+'">').html('<i class="glyphicon glyphicon-picture"></i>').prependTo("#chat-controls"),this.$smilesPanel=$('<div id="smiles-panel">').prependTo("#chat-panel").hide(),this.renderSmiles=function(){for(var smiles=CHANNEL.emotes,smileIndex=0,smilesLen=smiles.length;smilesLen>smileIndex;smileIndex++)$('<img class="smile-on-panel">').attr({src:smiles[smileIndex].image}).data("name",smiles[smileIndex].name).appendTo(that.$smilesPanel)},this.insertSmile=function(smileName){app.getModule("utils").done(function(utilsModule){utilsModule.addMessageToChatInput(" "+smileName+" ","end")})},$(document.body).on("click",".smile-on-panel",function(){that.insertSmile($(this).data("name"))}),this.$smilesBtn.on("click",function(){var smilesAndPicturesTogether=that.smilesAndPicturesTogether||!1;0===$("#favourite-pictures-panel").length||smilesAndPicturesTogether||$("#favourite-pictures-panel").hide(),that.$smilesPanel.toggle(),smilesAndPicturesTogether||($(this).hasClass("btn-default")?(0!==$("#favourite-pictures-btn").length&&$("#favourite-pictures-btn").hasClass("btn-success")&&($("#favourite-pictures-btn").removeClass("btn-success"),$("#favourite-pictures-btn").addClass("btn-default")),$(this).removeClass("btn-default"),$(this).addClass("btn-success")):($(this).removeClass("btn-success"),$(this).addClass("btn-default")))}),this.run=function(){that.renderSmiles()}}),cytubeEnhanced.setModule("standardUITranslate",function(app){0!==$("#newpollbtn").length&&$("#newpollbtn").text(app.t("standardUI[.]Create a poll")),0!==$("#showmediaurl").length&&$("#showmediaurl").html(app.t("standardUI[.]Add video")).attr({title:app.t("standardUI[.]Add video from url")}).detach().insertBefore($("#showsearch")),0!==$(".navbar-brand").length&&$(".navbar-brand").text(app.channelName),0!==$("#usercount").length&&($("#usercount").text($("#usercount").text().replace("connected users",app.t("standardUI[.]connected users")).replace("connected user",app.t("standardUI[.]connected user"))),socket.on("usercount",function(){$("#usercount").text($("#usercount").text().replace("connected users",app.t("standardUI[.]connected users")).replace("connected user",app.t("standardUI[.]connected user")))})),calcUserBreakdown=function(oldCalcUserBreakdown){return function(){var chatInfo=oldCalcUserBreakdown(),translatedChatInfo={},chatInfoTranslateMap={AFK:app.t("standardUI[.]AFK"),Anonymous:app.t("standardUI[.]Anonymous"),"Channel Admins":app.t("standardUI[.]Channel Admins"),Guests:app.t("standardUI[.]Guests"),Moderators:app.t("standardUI[.]Moderators"),"Regular Users":app.t("standardUI[.]Regular Users"),"Site Admins":app.t("standardUI[.]Site Admins")};for(var chatInfoElement in chatInfo)translatedChatInfo[chatInfoTranslateMap[chatInfoElement]]=chatInfo[chatInfoElement];return translatedChatInfo}}(calcUserBreakdown),0!==$("#welcome").length&&$("#welcome").text(app.t("standardUI[.]Welcome, ")+CLIENT.name),0!==$("#logout").length&&$("#logout").text(app.t("standardUI[.]Log out")),0!==$("#username").length&&$("#username").attr({placeholder:app.t("standardUI[.]Login")}),0!==$("#password").length&&$("#password").attr({placeholder:app.t("standardUI[.]Password")}),0!==$("#loginform").find(".checkbox").find(".navbar-text-nofloat").length&&$("#loginform").find(".checkbox").find(".navbar-text-nofloat").text(app.t("standardUI[.]Remember me")),$("#login")&&$("#login").text(app.t("standardUI[.]Site login"));var menuTranslateMap={Home:app.t("standardUI[.]Home"),Account:app.t("standardUI[.]Account"),Logout:app.t("standardUI[.]Logout"),Channels:app.t("standardUI[.]Channels"),Profile:app.t("standardUI[.]Profile"),"Change Password/Email":app.t("standardUI[.]Change Password/Email"),Login:app.t("standardUI[.]Log in"),Register:app.t("standardUI[.]Register"),Options:app.t("standardUI[.]Options"),"Channel Settings":app.t("standardUI[.]Channel Settings"),Layout:app.t("standardUI[.]Layout"),"Chat Only":app.t("standardUI[.]Chat Only"),"Remove Video":app.t("standardUI[.]Remove Video")};$(".navbar").find(".navbar-nav").children().each(function(){$(this).find("a").each(function(){for(var elementToTranslate in menuTranslateMap)$(this).html($(this).html().replace(elementToTranslate,menuTranslateMap[elementToTranslate]))})}),0!==$("#mediaurl").length&&$("#mediaurl").attr("placeholder",app.t("standardUI[.]Video url")),0!==$("#queue_next").length&&$("#queue_next").text(app.t("standardUI[.]Next")),0!==$("#queue_end").length&&$("#queue_end").text(app.t("standardUI[.]At end")),$(".qbtn-play").each(function(){$(this).html($(this).html().replace(/\s*Play/," "+app.t("standardUI[.]Play")))}),$(".qbtn-next").each(function(){$(this).html($(this).html().replace(/\s*Queue Next/," "+app.t("standardUI[.]Queue Next")))}),$(".qbtn-tmp").each(function(){$(this).html($(this).html().replace(/\s*Make Temporary/," "+app.t("standardUI[.]Make Temporary")).replace(/\s*Make Permanent/," "+app.t("standardUI[.]Make Permanent")))}),$(".qbtn-delete").each(function(){$(this).html($(this).html().replace(/\s*Delete/," "+app.t("standardUI[.]Delete")))}),addQueueButtons=function(oldAddQueueButtons){return function(li){var result=oldAddQueueButtons(li);return 0!==li.find(".qbtn-play").length&&li.find(".qbtn-play").html(li.find(".qbtn-play").html().replace(/\s*Play/," "+app.t("standardUI[.]Play"))),0!==li.find(".qbtn-next").length&&li.find(".qbtn-next").html(li.find(".qbtn-next").html().replace(/\s*Queue Next/," "+app.t("standardUI[.]Queue Next"))),0!==li.find(".qbtn-tmp").length&&li.find(".qbtn-tmp").html(li.find(".qbtn-tmp").html().replace(/\s*Make Temporary/," "+app.t("standardUI[.]Make Temporary")).replace(/\s*Make Permanent/," "+app.t("standardUI[.]Make Permanent"))),0!==li.find(".qbtn-delete").length&&li.find(".qbtn-delete").html(li.find(".qbtn-delete").html().replace(/\s*Delete/," "+app.t("standardUI[.]Delete"))),result}}(addQueueButtons),socket.on("setTemp",function(data){var tmpBtn=$(".pluid-"+data.uid).find(".qbtn-tmp");0!==tmpBtn.length&&tmpBtn.html(data.temp?tmpBtn.html().replace("Сделать временным",app.t("standardUI[.]Make Temporary")):tmpBtn.html().replace("Сделать постоянным",app.t("standardUI[.]Make Permanent")))}),0!==$("#guestname").length&&$("#guestname").attr("placeholder",app.t("standardUI[.]Name")),$("#guestlogin")&&$("#guestlogin").find(".input-group-addon").text(app.t("standardUI[.]Guest login"))}),cytubeEnhanced.setModule("userConfig",function(app,settings){var that=this,defaultSettings={layoutConfigButton:!0,smilesAndPicturesTogetherButton:!0,minimizeButton:!0};settings=$.extend(defaultSettings,settings),this.layoutOptions={"hide-header":{title:app.t("userConfig[.]Hide header"),"default":"no",values:{yes:app.t("userConfig[.]Yes"),no:app.t("userConfig[.]No")}},"player-position":{title:app.t("userConfig[.]Player position"),"default":"right",values:{left:app.t("userConfig[.]Left"),right:app.t("userConfig[.]Right"),center:app.t("userConfig[.]Center")}},"playlist-position":{title:app.t("userConfig[.]Playlist position"),"default":"right",values:{left:app.t("userConfig[.]Left"),right:app.t("userConfig[.]Right")}},"userlist-position":{title:app.t("userConfig[.]Chat's userlist position"),"default":"left",values:{left:app.t("userConfig[.]Left"),right:app.t("userConfig[.]Right")}}},this.UserConfig=function(){this.options={},this.set=function(name,value){this.options[name]=value,setOpt(CHANNEL.name+"_config-"+name,value)},this.get=function(name){return this.options[name]},this.toggle=function(name){var result=!this.get(name);return this.set(name,result),result},this.loadOption=function(name,defaultValue){var option=getOrDefault(CHANNEL.name+"_config-"+name,defaultValue);return void 0!==this.configFunctions[name]&&this.configFunctions[name](option),option}},this.userConfig=new this.UserConfig,this.userConfig.loadDefaults=function(){var options=this.options;if(settings.minimizeButton&&(options.minimize=this.loadOption("minimize",!1)),settings.smilesAndPicturesTogetherButton&&app.isModulePermitted("smiles")&&app.isModulePermitted("favouritePictures")&&(options["smiles-and-pictures"]=this.loadOption("smiles-and-pictures",!1),app.getModule("smiles").done(function(smilesModule){smilesModule.smilesAndPicturesTogether=options["smiles-and-pictures"]}),app.getModule("favouritePictures").done(function(favouritePicturesModule){favouritePicturesModule.smilesAndPicturesTogether=options["smiles-and-pictures"]})),settings.layoutConfigButton){for(var layoutOption in that.layoutOptions)options[layoutOption]=this.loadOption(layoutOption,that.layoutOptions[layoutOption]["default"]||!1);options["user-css"]=this.loadOption("user-css","")}},this.userConfig.configFunctions={minimize:function(isMinimized){isMinimized?($("#motdrow").hide(),$("#queue").parent().hide(),that.$configWrapper.hide(),that.$minBtn.removeClass("btn-default"),that.$minBtn.addClass("btn-success")):($("#motdrow").show(),$("#queue").parent().show(),that.$configWrapper.show(),that.$minBtn.removeClass("btn-success"),that.$minBtn.addClass("btn-default"))},"smiles-and-pictures":function(isTurnedOn){app.getModule("smiles").done(function(smilesModule){smilesModule.smilesAndPicturesTogether=isTurnedOn}),app.getModule("favouritePictures").done(function(favouritePicturesModule){favouritePicturesModule.smilesAndPicturesTogether=isTurnedOn}),isTurnedOn?(that.$smilesAndPicturesBtn.removeClass("btn-default"),that.$smilesAndPicturesBtn.addClass("btn-success"),$("#smiles-btn").hide(),$("#smiles-panel").hide(),$("#smiles-btn").addClass("btn-default"),$("#smiles-btn").removeClass("btn-success"),$("#favourite-pictures-btn").hide(),$("#favourite-pictures-panel").hide(),$("#favourite-pictures-btn").addClass("btn-default"),$("#favourite-pictures-btn").removeClass("btn-success"),$('<button id="smiles-and-picture-btn" class="btn btn-sm btn-default" title="'+app.t("userConfig[.]Show emotes and favorite images")+'">').html('<i class="glyphicon glyphicon-picture"></i> и <i class="glyphicon glyphicon-th"></i>').prependTo($("#chat-controls")).on("click",function(){$("#smiles-btn").click(),$("#favourite-pictures-btn").click(),$(this).hasClass("btn-default")?($(this).removeClass("btn-default"),$(this).addClass("btn-success")):($(this).removeClass("btn-success"),$(this).addClass("btn-default"))})):(0!==$("#smiles-and-picture-btn").length&&$("#smiles-and-picture-btn").remove(),that.$smilesAndPicturesBtn.removeClass("btn-success"),that.$smilesAndPicturesBtn.addClass("btn-default"),$("#smiles-btn").show(),$("#favourite-pictures-btn").show(),$("#smiles-panel").hide(),$("#favourite-pictures-panel").hide())}},this.toggleConfigPanel=function(){that.$configWrapper.toggle()},this.$configWrapper=$('<div id="config-wrapper" class="col-lg-12 col-md-12">').appendTo("#leftpane-inner"),this.$configBody=$('<div id="config-body" class="well form-horizontal">').appendTo(this.$configWrapper),this.$configBtn=$('<button id="layout-btn" class="btn btn-sm btn-default pull-right">').html('<span class="glyphicon glyphicon-cog"></span> '+app.t("userConfig[.]Settings")).appendTo("#leftcontrols").on("click",function(){that.toggleConfigPanel()}),this.$layoutForm=$('<div id="layout-config-form" class="form-group">').appendTo(this.$configBody).append($('<div class="col-lg-3 col-md-3 control-label">'+app.t("userConfig[.]Layout")+"</div>")),this.$layoutWrapper=$('<div id="layout-config-wrapper" class="col-lg-9 col-md-9 text-center">').appendTo(this.$layoutForm),this.$layoutBtnWrapper=$('<div id="layout-config-btn-wrapper" class="btn-group">').appendTo(this.$layoutWrapper),settings.layoutConfigButton||settings.minimizeButton||this.$layoutForm.hide(),this.configUserLayout=function(userConfig){var $settingsWrapper=$('<div class="form-horizontal">');for(var layoutOption in that.layoutOptions){var $formGroup=$('<div class="form-group">').appendTo($settingsWrapper),$selectWrapper=($('<label for="'+layoutOption+'" class="col-sm-2 control-label">'+that.layoutOptions[layoutOption].title+"</label>").appendTo($formGroup),$('<div class="col-sm-10">').appendTo($formGroup)),$select=$('<select id="'+layoutOption+'" class="form-control">').appendTo($selectWrapper);for(var selectOption in that.layoutOptions[layoutOption].values){{$('<option value="'+selectOption+'">'+that.layoutOptions[layoutOption].values[selectOption]+"</option>").appendTo($select)}selectOption===userConfig.get(layoutOption)&&$select.val(selectOption)}}var $userCssWrapper=$('<div class="form-group">').appendTo($settingsWrapper),$userCssTextareaWrapper=($('<label for="user-css" class="col-sm-2 control-label">'+app.t("userConfig[.]User CSS")+"</label>").appendTo($userCssWrapper),$('<div class="col-sm-10">').appendTo($userCssWrapper)),$btnWrapper=($('<textarea id="user-css" class="form-control" rows="7">').appendTo($userCssTextareaWrapper).val(userConfig.get("user-css")),$("<div>"));$('<button type="button" id="cancel-user-layout" class="btn btn-info" data-dismiss="modal">'+app.t("userConfig[.]Cancel")+"</button>").appendTo($btnWrapper),$('<button type="button" id="reset-user-layout" class="btn btn-danger">'+app.t("userConfig[.]Reset settings")+"</button>").appendTo($btnWrapper).on("click",function(){if(confirm(app.t("userConfig[.]All the settings including user css will be reset, continue?"))){for(var layoutOption in that.layoutOptions)userConfig.set(layoutOption,that.layoutOptions[layoutOption]["default"]);userConfig.set("user-css",""),that.applyLayoutSettings(userConfig),$modalWindow.modal("hide")}}),$('<button type="button" id="save-user-layout" class="btn btn-success">').text(app.t("userConfig[.]Save")).appendTo($btnWrapper).on("click",function(){for(var layoutOption in that.layoutOptions)0!==$("#"+layoutOption).length&&userConfig.set(layoutOption,$("#"+layoutOption).val());0!==$("#user-css").length&&userConfig.set("user-css",$("#user-css").val()),that.applyLayoutSettings(userConfig),$modalWindow.modal("hide")});var $modalWindow;app.getModule("utils").done(function(utilsModule){$modalWindow=utilsModule.createModalWindow(app.t("userConfig[.]Layout settings"),$settingsWrapper,$btnWrapper)})},this.$layoutConfigBtn=$('<button id="layout-configuration-btn" class="btn btn-default">').text(app.t("userConfig[.]Settings")).appendTo(this.$layoutBtnWrapper).on("click",function(){that.configUserLayout(that.userConfig)}),settings.layoutConfigButton||this.$layoutConfigBtn.hide(),this.minifyInterface=function(userConfig){var isMinimized=userConfig.toggle("minimize");userConfig.configFunctions.minimize(isMinimized)},this.$minBtn=$('<button id="layout-min-btn" class="btn btn-default">').text(app.t("userConfig[.]Minimize")).appendTo(this.$layoutBtnWrapper).on("click",function(){that.minifyInterface(that.userConfig)}),settings.minimizeButton||this.$minBtn.hide(),app.isModulePermitted("smiles")&&app.isModulePermitted("favouritePictures")&&$.when(app.getModule("smiles"),app.getModule("favouritePictures")).then(function(){that.$commonConfigForm=$('<div id="common-config-form" class="form-group">').append($('<div class="col-lg-3 col-md-3 control-label">').text(app.t("userConfig[.]Common"))).appendTo(that.$configBody),that.$commonConfigWrapper=$('<div id="common-config-wrapper" class="col-lg-9 col-md-9 text-center">').appendTo(that.$commonConfigForm),that.$commonConfigBtnWrapper=$('<div id="common-config-btn-wrapper" class="btn-group">').appendTo(that.$commonConfigWrapper),that.toggleSmilesAndPictures=function(){var isTurnedOn=that.userConfig.toggle("smiles-and-pictures");that.userConfig.configFunctions["smiles-and-pictures"](isTurnedOn)},that.$smilesAndPicturesBtn=$('<button id="common-config-smiles-and-pictures-btn" class="btn btn-default">').html('<i class="glyphicon glyphicon-picture"></i> '+app.t("userConfig[.]and")+' <i class="glyphicon glyphicon-th"></i>').appendTo(that.$commonConfigBtnWrapper).on("click",function(){that.toggleSmilesAndPictures()}),settings.smilesAndPicturesTogetherButton||(that.$smilesAndPicturesBtn.hide(),that.$commonConfigForm.hide())}),this.applyLayoutSettings=function(userConfig){"yes"===userConfig.get("hide-header")?$("#motdrow").hide():$("#motdrow").show(),"left"===userConfig.get("player-position")?($("#chatwrap").hasClass("col-md-10 col-md-offset-1")&&($("#chatwrap").removeClass("col-md-10 col-md-offset-1"),$("#chatwrap").addClass("col-lg-5 col-md-5")),$("#videowrap").hasClass("col-md-10 col-md-offset-1")&&($("#videowrap").removeClass("col-md-10 col-md-offset-1"),$("#videowrap").addClass("col-lg-7 col-md-7")),$("#videowrap").detach().insertBefore($("#chatwrap"))):"center"===userConfig.get("player-position")?($("#chatwrap").removeClass(function(index,css){return(css.match(/(\s)*col-(\S)+/g)||[]).join("")}),$("#videowrap").removeClass(function(index,css){return(css.match(/(\s)*col-(\S)+/g)||[]).join("")}),$("#chatwrap").addClass("col-md-10 col-md-offset-1"),$("#videowrap").addClass("col-md-10 col-md-offset-1"),$("#videowrap").detach().insertBefore($("#chatwrap"))):($("#chatwrap").hasClass("col-md-10 col-md-offset-1")&&($("#chatwrap").removeClass("col-md-10 col-md-offset-1"),$("#chatwrap").addClass("col-lg-5 col-md-5")),$("#videowrap").hasClass("col-md-10 col-md-offset-1")&&($("#videowrap").removeClass("col-md-10 col-md-offset-1"),$("#videowrap").addClass("col-lg-7 col-md-7")),$("#chatwrap").detach().insertBefore($("#videowrap"))),"left"===userConfig.get("playlist-position")?($("#rightcontrols").detach().insertBefore($("#leftcontrols")),$("#rightpane").detach().insertBefore($("#leftpane"))):($("#leftcontrols").detach().insertBefore($("#rightcontrols")),$("#leftpane").detach().insertBefore($("#rightpane"))),"right"===userConfig.get("userlist-position")?$("#userlist").addClass("pull-right"):$("#userlist").removeClass("pull-right"),""!==userConfig.get("user-css")?$("head").append('<style id="user-style" type="text/css">'+userConfig.get("user-css")+"</style>"):0!==$("#user-style").length&&$("#user-style").remove(),$("#refresh-video").click()},this.run=function(){that.userConfig.loadDefaults(),settings.layoutConfigButton&&that.applyLayoutSettings(that.userConfig)}}),cytubeEnhanced.setModule("utils",function(app,settings){var that=this,defaultSettings={unfixedTopNavbar:!0,insertUsernameOnClick:!0,showScriptInfo:!0};settings=$.extend(defaultSettings,settings),this.addMessageToChatInput=function(message,position){position=position||"end","begin"===position?message+=$("#chatline").val():message=$("#chatline").val()+message,$("#chatline").val(message).focus()},settings.insertUsernameOnClick&&$("#messagebuffer").on("click",".username",function(){that.addMessageToChatInput($(this).text(),"begin")}),this.createModalWindow=function($headerContent,$bodyContent,$footerContent){var $outer=$('<div class="modal fade chat-help-modal" role="dialog" tabindex="-1">').appendTo($("body")),$modal=$('<div class="modal-dialog modal-lg">').appendTo($outer),$content=$('<div class="modal-content">').appendTo($modal);if(void 0!==$headerContent){var $header=$('<div class="modal-header">').appendTo($content);$('<button type="button" class="close" data-dismiss="modal" aria-label="Закрыть">').html('<span aria-hidden="true">&times;</span>').appendTo($header),$('<h3 class="modal-title">').append($headerContent).appendTo($header)}return void 0!==$bodyContent&&$('<div class="modal-body">').append($bodyContent).appendTo($content),void 0!==$footerContent&&$('<div class="modal-footer">').append($footerContent).appendTo($content),$outer.on("hidden.bs.modal",function(){$(this).remove()}),$outer.modal({keyboard:!0}),$outer},this.run=function(){settings.unfixedTopNavbar&&$("#wrap").children(".navbar-fixed-top").removeClass("navbar-fixed-top"),settings.showScriptInfo&&$("#footer").children(".container").append('<p class="text-muted credit">CyTube Enhanced (<a href="https://github.com/kaba99/cytube-enhanced">GitHub</a>)</p>'),setTimeout(function(){handleWindowResize()},3e3)}}),cytubeEnhanced.setModule("videoControls",function(app,settings){var that=this,defaultSettings={turnOffVideoOption:!0,selectQualityOption:!0,youtubeFlashPlayerForGoogleDocsOption:!0,expandPlaylistOption:!0,showVideoContributorsOption:!0};settings=$.extend(defaultSettings,settings),this.youtubeJavascriptPlayerForGoogleDrive=function(data){var that=this;that.videoId=data.id,that.videoLength=data.seconds,that.init=function(){removeOld(),that.videoURL="https://video.google.com/get_player?wmode=opaque&ps=docs&partnerid=30&version=3",that.videoURL+="&docid="+that.videoId,that.videoURL+="&autoplay=1",that.videoURL+="&fs=1",that.videoURL+="&showinfo=0",that.videoURL+="&rel=0",that.videoURL+="&vq="+(USEROPTS.default_quality||"auto"),that.videoURL+="&start="+parseInt(data.currentTime,10),that.videoURL+="&enablejsapi=1",that.videoURL+="&playerapiid="+that.videoId,that.videoURL+="&cc_load_policy=0";var atts={id:"ytapiplayer"},params={allowScriptAccess:"always",allowFullScreen:"true"};swfobject.embedSWF(that.videoURL,"ytapiplayer",VWIDTH,VHEIGHT,"8",null,null,params,atts),onYouTubePlayerReady=function(playerId){that.player=$("#ytapiplayer")[0],that.player.addEventListener("onStateChange","onytplayerStateChange")},onytplayerStateChange=function(newState){var statesMap={"-1":"beforeVideo",0:"end",1:"play",2:"pause",3:"buf",5:"queue"};"beforeVideo"===statesMap[newState]?that.setVolume(VOLUME):"play"===statesMap[newState]?(PLAYER.paused=!1,CLIENT.leader&&sendVideoUpdate()):"pause"===statesMap[newState]?(PLAYER.paused=!0,CLIENT.leader&&sendVideoUpdate()):"end"===statesMap[newState]&&CLIENT.leader&&socket.emit("playNext")}},that.load=function(data){that.videoId=data.id,that.videoLength=data.seconds,that.init()},that.pause=function(){that.player&&that.player.pauseVideo&&that.player.pauseVideo()},that.play=function(){that.player&&that.player.playVideo&&that.player.playVideo()},that.getTime=function(callback){if(that.player&&that.player.getCurrentTime){var t=parseFloat(that.player.getCurrentTime());callback(t)}},that.seek=function(time){that.player.seekTo&&that.player.seekTo(time)},that.getVolume=function(callback){that.player&&that.player.getVolume&&callback(that.player.getVolume()/100)},that.setVolume=function(volume){that.player.setVolume(100*volume)},that.init()},$("#mediarefresh").hide(),this.$topVideoControls=$('<div id="top-video-controls" class="btn-group">').appendTo("#videowrap"),this.refreshVideo=function(){PLAYER.mediaType="",PLAYER.mediaId="",socket.emit("playerReady")},this.$refreshVideoBtn=$('<button id="refresh-video" class="btn btn-sm btn-default" title="'+app.t("video[.]Refresh video")+'">').html('<i class="glyphicon glyphicon-refresh">').appendTo(this.$topVideoControls).on("click",function(){that.refreshVideo()}),this.hidePlayer=function($hidePlayerBtn){if($hidePlayerBtn.hasClass("btn-default")){var $playerWindow=$("#videowrap").find(".embed-responsive");$playerWindow.css({position:"relative"}),$('<div id="player-overlay">').appendTo($playerWindow),$hidePlayerBtn.html('<i class="glyphicon glyphicon-film">'),$hidePlayerBtn.removeClass("btn-default"),$hidePlayerBtn.addClass("btn-success")}else $("#player-overlay").remove(),$hidePlayerBtn.html('<i class="glyphicon glyphicon-ban-circle">'),$hidePlayerBtn.removeClass("btn-success"),$hidePlayerBtn.addClass("btn-default")},this.$hidePlayerBtn=$('<button id="hide-player-btn" class="btn btn-sm btn-default" title="'+app.t("video[.]Hide video")+'">').html('<i class="glyphicon glyphicon-ban-circle">').appendTo(this.$topVideoControls).on("click",function(){that.hidePlayer($(this))}),settings.turnOffVideoOption||this.$hidePlayerBtn.hide(),this.qualityLabelsTranslate={auto:"авто",240:"240p",360:"360p",480:"480p",720:"720p",1080:"1080p",best:app.t("video[.]best")},this.youtubeQualityMap={auto:"default"},this.$videoQualityBtnGroup=$('<div class="btn-group">').html('<button type="button" class="btn btn-default btn-sm video-dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'+app.t("video[.]Quality")+": "+this.qualityLabelsTranslate[USEROPTS.default_quality||"auto"]+' <span class="caret"></span></button>').appendTo(this.$topVideoControls),this.$videoQualityList=$('<ul class="dropdown-menu">');for(var qualityName in that.qualityLabelsTranslate)$("<li>").html('<a href="#" data-quality="'+qualityName+'">'+this.qualityLabelsTranslate[qualityName]+"</a>").appendTo(this.$videoQualityList);this.$videoQualityList.appendTo(this.$videoQualityBtnGroup),this.changeVideoQuality=function($qualityLink){if(that.YOUTUBE_JS_PLAYER_NOW){var quality=$qualityLink.data("quality");quality=void 0!==that.youtubeQualityMap[quality]?that.youtubeQualityMap[quality]:quality,PLAYER.player.setPlaybackQuality(quality)}that.settingsFix(),$("#us-default-quality").val($qualityLink.data("quality")),saveUserOptions(),that.$refreshVideoBtn.click(),that.$videoQualityBtnGroup.find("button").html(app.t("video[.]Quality")+": "+$qualityLink.text()+' <span class="caret"></span>'),$(".video-dropdown-toggle").dropdown()},this.$videoQualityBtnGroup.on("click","a",function(){return that.changeVideoQuality($(this)),!1}),settings.selectQualityOption||this.$videoQualityBtnGroup.hide(),this.settingsFix=function(){$("#us-theme").val(USEROPTS.theme),$("#us-layout").val(USEROPTS.layout),$("#us-no-channelcss").prop("checked",USEROPTS.ignore_channelcss),$("#us-no-channeljs").prop("checked",USEROPTS.ignore_channeljs),$("#us-synch").prop("checked",USEROPTS.synch),$("#us-synch-accuracy").val(USEROPTS.sync_accuracy),$("#us-wmode-transparent").prop("checked",USEROPTS.wmode_transparent),$("#us-hidevideo").prop("checked",USEROPTS.hidevid),$("#us-playlistbuttons").prop("checked",USEROPTS.qbtn_hide),$("#us-oldbtns").prop("checked",USEROPTS.qbtn_idontlikechange),$("#us-default-quality").val(USEROPTS.default_quality||"auto"),$("#us-chat-timestamp").prop("checked",USEROPTS.show_timestamps),$("#us-sort-rank").prop("checked",USEROPTS.sort_rank),$("#us-sort-afk").prop("checked",USEROPTS.sort_afk),$("#us-blink-title").val(USEROPTS.blink_title),$("#us-ping-sound").val(USEROPTS.boop),$("#us-sendbtn").prop("checked",USEROPTS.chatbtn),$("#us-no-emotes").prop("checked",USEROPTS.no_emotes),$("#us-modflair").prop("checked",USEROPTS.modhat),$("#us-joinmessage").prop("checked",USEROPTS.joinmessage),$("#us-shadowchat").prop("checked",USEROPTS.show_shadowchat)},this.toggleGoogleDrivePlayer=function($youtubeJavascriptPlayerBtn){that.YOUTUBE_JS_PLAYER_TURNED_ON=!that.YOUTUBE_JS_PLAYER_TURNED_ON,setOpt(CHANNEL.name+"_config-yt-js-player",that.YOUTUBE_JS_PLAYER_TURNED_ON),that.YOUTUBE_JS_PLAYER_TURNED_ON?($youtubeJavascriptPlayerBtn.removeClass("btn-default"),$youtubeJavascriptPlayerBtn.addClass("btn-success")):($youtubeJavascriptPlayerBtn.removeClass("btn-success"),$youtubeJavascriptPlayerBtn.addClass("btn-default")),that.$refreshVideoBtn.click()},this.$youtubeJavascriptPlayerBtn=$('<button id="youtube-javascript-player-btn" class="btn btn-sm btn-default">').text(app.t("video[.]Use Youtube JS Player")).appendTo(this.$topVideoControls).on("click",function(){that.toggleGoogleDrivePlayer($(this))}),settings.youtubeFlashPlayerForGoogleDocsOption||this.$youtubeJavascriptPlayerBtn.hide(),this.PLAYLIST_HEIGHT=500,this.expandPlaylist=function($expandPlaylistBtn){$expandPlaylistBtn.hasClass("btn-success")?($("#queue").css("max-height",that.PLAYLIST_HEIGHT+"px"),$expandPlaylistBtn.attr("title",app.t("video[.]Expand playlist")),$expandPlaylistBtn.removeClass("btn-success"),$expandPlaylistBtn.addClass("btn-default")):($("#queue").css("max-height","100000px"),$expandPlaylistBtn.attr("title",app.t("video[.]Unexpand playlist")),$expandPlaylistBtn.removeClass("btn-default"),$expandPlaylistBtn.addClass("btn-success"),scrollQueue())},this.$expandPlaylistBtn=$('<button id="expand-playlist-btn" class="btn btn-sm btn-default" data-expanded="0" title="'+app.t("video[.]Expand playlist")+'">').append('<span class="glyphicon glyphicon-resize-full">').prependTo("#videocontrols").on("click",function(){that.expandPlaylist($(this))}),settings.expandPlaylistOption||this.$expandPlaylistBtn.hide(),this.$scrollToCurrentBtn=$('<button id="scroll-to-current-btn" class="btn btn-sm btn-default" title="'+app.t("video[.]Scroll the playlist to the current video")+'">').append('<span class="glyphicon glyphicon-hand-right">').prependTo("#videocontrols").on("click",function(){scrollQueue()}),this.showVideoContributorsList=function(){var $bodyWrapper=$("<div>"),contributorsList={};$("#queue .queue_entry").each(function(){var username=$(this).attr("title").replace("Added by: ","");void 0===contributorsList[username]?contributorsList[username]=1:contributorsList[username]+=1}),$bodyWrapper.append($("<p>"+app.t("video[.]Video's count")+": "+($("#queue .queue_entry").length+1)+"</p>"));var $contributorsListOl=$("<ol>");for(var contributor in contributorsList)$contributorsListOl.append($("<li>"+contributor+": "+contributorsList[contributor]+".</li>"));$contributorsListOl.appendTo($bodyWrapper),app.getModule("utils").done(function(utilsModule){utilsModule.createModalWindow(app.t("video[.]Contributors' list"),$bodyWrapper)})},this.$videoContributorsBtn=$('<button id="video-contributors-btn" class="btn btn-sm btn-default" title="'+app.t("video[.]Contributors' list")+'">').append('<span class="glyphicon glyphicon-user">').prependTo("#videocontrols").on("click",function(){that.showVideoContributorsList()}),settings.showVideoContributorsOption||this.$videoContributorsBtn.hide(),this.handleGoogleDrivePlayer=function(data){that.YOUTUBE_JS_PLAYER_TURNED_ON&&"fi"===data.type&&/google/.test(data.url)?(that.YOUTUBE_JS_PLAYER_NOW=!0,PLAYER=new that.youtubeJavascriptPlayerForGoogleDrive(data),PLAYER.type=data.type):that.YOUTUBE_JS_PLAYER_NOW=!1;

},this.run=function(){settings.youtubeFlashPlayerForGoogleDocsOption&&(that.YOUTUBE_JS_PLAYER_TURNED_ON=getOrDefault(CHANNEL.name+"_config-yt-js-player",!1),socket.on("changeMedia",function(data){that.handleGoogleDrivePlayer(data)}),that.YOUTUBE_JS_PLAYER_TURNED_ON&&(that.$youtubeJavascriptPlayerBtn.removeClass("btn-default"),that.$youtubeJavascriptPlayerBtn.addClass("btn-success"),that.$refreshVideoBtn.click())),settings.selectQualityOption&&$("#us-default-quality").on("change",function(){that.$videoQualityBtnGroup.find("button").html(app.t("video[.]Quality")+": "+that.qualityLabelsTranslate[$(this).val()]+' <span class="caret"></span>')})}}),$(document).ready(function(){cytubeEnhanced.run()});